<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xuanli.oepcms.mapper.UserMapper">

	<!-- 借助sql元素定义一个动态的sql,其他位置需要时,直接借助include元素进行包含 -->
	<sql id="queryWhereId">
		<where>
		  		<if test="userId != null and userId != ''"> and user_id = #{userId} </if>
		  		<if test="username != null and username != ''"> and username = #{username} </if>
		  		<if test="name != null and name != ''"> and name = #{name} </if>
		  		<if test="password != null and password != ''"> and password = #{password} </if>
		  		<if test="deptId != null and deptId != ''"> and dept_id = #{deptId} </if>
		  		<if test="email != null and email != ''"> and email = #{email} </if>
		  		<if test="mobile != null and mobile != ''"> and mobile = #{mobile} </if>
		  		<if test="status != null and status != ''"> and status = #{status} </if>
		  		<if test="userIdCreate != null and userIdCreate != ''"> and user_id_create = #{userIdCreate} </if>
		  		<if test="gmtCreate != null and gmtCreate != ''"> and gmt_create = #{gmtCreate} </if>
		  		<if test="gmtModified != null and gmtModified != ''"> and gmt_modified = #{gmtModified} </if>
		  		<if test="sex != null and sex != ''"> and sex = #{sex} </if>
		  		<if test="birth != null and birth != ''"> and birth = #{birth} </if>
		  		<if test="picId != null and picId != ''"> and pic_id = #{picId} </if>
		  		<if test="liveAddress != null and liveAddress != ''"> and live_address = #{liveAddress} </if>
		  		<if test="hobby != null and hobby != ''"> and hobby = #{hobby} </if>
		  		<if test="province != null and province != ''"> and province = #{province} </if>
		  		<if test="city != null and city != ''"> and city = #{city} </if>
		  		<if test="district != null and district != ''"> and district = #{district} </if>
		</where>
	</sql>
	<select id="find" resultType="com.xuanli.oepcms.entity.User">
		SELECT id,`username`,`password`,`desc`,`gender`,`mobile`,`birth_date`,`school_id`,`clas_id`,`salt`,`captcha`,`study_section`,`grade`,`book_edition`,`province`,
			`district`,`city`,`create_id`,`create_date`,`update_id`,`update_date`,`enable_flag`
		FROM xl_user
        <include refid="queryWhereId"/>
        <choose>
            <when test="mobile != null and mobile.trim() != ''">
                order by ${order}
            </when>
			<otherwise>
                order by id desc
			</otherwise>
        </choose>
		<if test="offset != null and limit != null">
			limit #{startIndex},#{pageSize}
		</if>
	</select>
	
	<!-- 保存用户信息 -->
	<insert id="insertUser" 
	 parameterType="com.xuanli.oepcms.entity.User"
	 useGeneratedKeys="true" 
	 keyProperty="id">
		INSERT into xl_user
		(`username`,`password`,`desc`,`gender`,`mobile`,`birth_date`,`school_id`,`clas_id`,`salt`,`captcha`,`study_section`,`grade`,`book_edition`,`province`,
			`district`,`city`,`create_id`,`create_date`,`update_id`,`update_date`,`enable_flag`)
		VALUES
			(#{username},#{password},#{desc},#{gender},#{mobile},#{birthDate},#{schoolId},#{clasId},#{salt},#{captcha},#{studySection},#{grade},#{bookEdition},#{province},
			#{district},#{city},#{createId},now(),#{updateId},now(),#{enableFlag})
	</insert>
	<!-- 修改更新用户信息 -->
		<update id="updateUser" parameterType="com.xuanli.oepcms.entity.User">
		update xl_user 
		<set>
			<if test="username != null">`username` = #{username}, </if>
			<if test="password != null">`password` = #{password}, </if>
			<if test="desc != null">`desc` = #{desc}, </if>
			<if test="gender != null">`gender` = #{gender}, </if>
			<if test="birthDate != null">`birth_date` = #{birthDate}, </if>
			<if test="schoolId != null">`school_id` = #{schoolId}, </if>
			<if test="clasId != null">`clas_id` = #{clasId}, </if>
			<if test="salt != null">`salt` = #{salt}, </if>
			<if test="captcha != null">`captcha` = #{captcha}, </if>
			<if test="studySection != null">`study_section` = #{studySection}, </if>
			<if test="grade != null">`grade` = #{grade}, </if>
			<if test="bookEdition != null">`book_edition` = #{bookEdition}, </if>
			<if test="createId != null">`create_id` = #{createId}, </if>
			<if test="createDate != null">`create_date` = #{createDate}, </if>
			<if test="updateId != null">`update_id` = #{updateId}, </if>
			<if test="updateDate != null">`update_date` = #{updateDate}, </if>
			<if test="enableFlag != null">`enable_flag` = #{enableFlag}, </if>
			<if test="province != null">`province` = #{province}, </if>
			<if test="city != null">`city` = #{city}, </if>
			<if test="district != null">`district` = #{district}</if>
		</set>
		where id = #{id}
	</update>
	<select id="count" resultType="int">
		SELECT COUNT(*) FROM xl_user
	    <include refid="queryWhereId"/>
	</select>
	<select id="findById" 
	        parameterType="java.lang.Integer"
	        resultType="com.xuanli.oepcms.entity.User">
		SELECT id,`username`,`password`,`desc`,`gender`,`mobile`,`birth_date`,`school_id`,`clas_id`,`salt`,`captcha`,`study_section`,`grade`,`book_edition`,`province`,
			`district`,`city`,`create_id`,`create_date`,`update_id`,`update_date`,`enable_flag`
		FROM xl_user
		WHERE id = #{value}
	</select>
		<!-- 根据用户名查询用户信息 -->
	<select id="findByName" 
	    parameterType="java.lang.String" 
	    resultType="com.xuanli.oepcms.entity.User">
		SELECT
			`username`,`password`,`desc`,`gender`,`mobile`,`birth_date`,`school_id`,`clas_id`,`salt`,`captcha`,`study_section`,`grade`,`book_edition`,`province`,
			`district`,`city`,`create_id`,`create_date`,`update_id`,`update_date`,`enable_flag`
		FROM xl_user
		WHERE 
			<if test="username!=null and username!=''">
				username LIKE CONCAT("%",#{username},"%")
			</if>
	</select>
</mapper>